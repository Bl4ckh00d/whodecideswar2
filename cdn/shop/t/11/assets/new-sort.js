function extractTextBetween(subject,start,end){try{return subject.split(start)[1].split(end)[0]}catch(e){console.log("Exception when extracting text",e)}}function updateUrlParams(cat_value,sort_value,search_value,tag_value){window.history.propertyIsEnumerable(null,null,`?${$.param({category:cat_value,sort_by:sort_value,search:search_value,type:tag_value})}`)}function restoreScrollPosition(){var scrollPosition=localStorage.getItem("scrollPosition");scrollPosition!==null&&($("html, body").animate({scrollTop:parseInt(scrollPosition)},{duration:0,easing:"linear"}),$(window).scrollTop()>=parseInt(scrollPosition)&&localStorage.removeItem("scrollPosition"))}function fetchProductsPage(cat_value,sort_value,search_value,tag_value,withHistory){let url="/collections/all";if(search_value){const withTag=`tag:${tag_value}%20`;url=`search?type=product&q=${tag_value?withTag:""}${search_value}&options[prefix]=last${sort_value?`&sort_by=${sort_value}`:""}`}else url=`/collections/${cat_value}/${tag_value}?sort_by=${sort_value}`;fetch(url).then(function(response){return response.text()}).then(function(html){if(html.includes("404 Not Found")||html.includes("Check the spelling or use a different word or phrase.")||html.includes("No products found"))document.getElementById("ProductGridContainer").innerHTML='<div class="product-not-found">No products found. Please try again.</div>',$(".collections-loader").css("display","none");else{var match=extractTextBetween(html,'<div id="StartSingleCollectionGridTemplate"></div>','<div id="EndSingleCollectionGridTemplate"></div>');document.getElementById("ProductGridContainer").innerHTML=match;var endlessScroll=new Ajaxinate({cache:!0,history:!0,callback:function(){withHistory&&(!/Mobi|Android/i.test(navigator.userAgent)||$(window).width()>768)&&restoreScrollPosition()}});$(".grid-collection-with-sidebar .collection.page-width").css("opacity","1"),$(".collections-loader").css("display","none"),withHistory||$(window).scrollTop(0)}}).catch(function(err){console.warn("Something went wrong.",err),document.getElementById("ProductGridContainer").innerHTML='<div class="product-not-found">No products found. Please try again.</div>',$(".collections-loader").css("display","none")})}function setActiveSortItem(listItems,value){$(listItems).each(function(){var $this=$(this);$this.attr("value").indexOf(value)!==-1&&$this.addClass("active").siblings().removeClass("active")})}function setActiveTag(value){$(`#${value}-accordion-header`).addClass("active").siblings().removeClass("active");var content=$(`#${value}-accordion-header`).next(".accordion-content");content.slideToggle()}function getProductsFromUrlParams(){let cat,sort2,searchVal;var searchParams=new URLSearchParams(window.location.search);sort2=searchParams.get("sort_by"),cat=searchParams.get("category"),searchVal=searchParams.get("search"),tag=searchParams.get("type"),cat||sort2||searchVal||tag?(fetchProductsPage(cat,sort2,searchVal,tag,!0),sort2&&setActiveSortItem("#sort-by li",sort2),cat&&setActiveSortItem("#women-category li",cat),tag&&setActiveTag(tag),tag==="women"&&cat&&setActiveSortItem("#women-category li",cat),tag==="men"&&cat&&setActiveSortItem("#men-category li",cat)):fetchProductsPage("new-arrivals",null,"",null,!0)}function setCategoryScrollText(){window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}();var speed=2e3;(function currencyItem(){var currencyPairWidth=$("#category .select-item:first-child").outerWidth();$(window).width()<1025?($("#category.collection-select").animate({marginLeft:-currencyPairWidth},speed,"linear",function(){$(this).css({marginLeft:0}).find("li:last").after($(this).find("li:first"))}),requestAnimationFrame(currencyItem)):$("#category.collection-select").stop(!0,!0)})()}function setSortScrollText(){window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}();var speed=5e3;(function currencyItem(){var currencyPairWidth=$("#sort-by .select-item:first-child").outerWidth();$(window).width()<500?($("#sort-by.collection-select").animate({marginLeft:-currencyPairWidth},speed,"linear",function(){$(this).css({marginLeft:0}).find("li:last").after($(this).find("li:first"))}),requestAnimationFrame(currencyItem)):$("#sort-by.collection-select").stop(!0,!0)})()}function debounce(func,delay){let timeout;return function(){clearTimeout(timeout),timeout=setTimeout(()=>func.apply(this,arguments),delay)}}let category="all",sort=$("#sort-by").find(".active").attr("value"),tag,searchValue;$("#sort-by li").click(function(e){$(this).addClass("active").siblings().removeClass("active"),sort=$(this).attr("value"),updateUrlParams(category,sort,searchValue,tag),fetchProductsPage(category,sort,searchValue,tag)}),$("#men-category li").click(function(){var searchVal=$("#search-field")[0].value;$(this).addClass("active").siblings().removeClass("active"),$("#women-category li").removeClass("active"),$("#women-category .accordion-header").removeClass("active"),category=$(this).attr("value"),sort=$("#sort-by").find(".active").attr("value"),$(".search-area.show #search-cancel-button").click(),searchValue=null,updateUrlParams(category,sort,searchValue,"men"),fetchProductsPage(category,sort,searchValue,"men")}),$("#women-category li").click(function(){$(this).addClass("active").siblings().removeClass("active"),$("#men-category li").removeClass("active"),category=$(this).attr("value"),sort=$("#sort-by").find(".active").attr("value"),$(".search-area.show #search-cancel-button").click(),searchValue=null,updateUrlParams(category,sort,searchValue,"women"),fetchProductsPage(category,sort,searchValue,"women")}),$(document).on("click",".full-unstyled-link",function(){const scrollPosition=$(window).scrollTop();localStorage.setItem("scrollPosition",scrollPosition)}),$(document).ready(function(){var scrollPosition=localStorage.getItem("scrollPosition");scrollPosition!==null&&scrollPosition>100&&getProductsFromUrlParams(),$("#reset-button").click(function(){$(".accordion-header").removeClass("active"),$(".select-item").removeClass("active"),$(".accordion-content").slideUp(),updateUrlParams("new-arrivals",null,"",""),fetchProductsPage("new-arrivals",null,"",""),$(".search-area.show #search-cancel-button").click(),$(window).scrollTop(0),sort=null,tag=null,searchValue=""}),$("#women-accordion .accordion-header").click(function(){if(!$(this).hasClass("active")){$(this).addClass("active"),tag="women",category="all";var content=$(this).next(".accordion-content");$("#men-accordion .accordion-content").slideUp(),$("#men-accordion .accordion-header").removeClass("active"),$("#men-category li").removeClass("active"),content.slideToggle(),updateUrlParams(category,sort,searchValue,tag),fetchProductsPage(category,sort,searchValue,tag)}}),$("#men-accordion .accordion-header").click(function(){if(!$(this).hasClass("active")){$(this).toggleClass("active"),tag="men",category="all";var content=$(this).next(".accordion-content");$("#women-accordion .accordion-content").slideUp(),$("#women-accordion .accordion-header").removeClass("active"),$("#women-category li").removeClass("active"),content.slideDown(),updateUrlParams(category,sort,searchValue,tag),fetchProductsPage(category,sort,searchValue,tag)}});const searchField=$("#search-field");function handleSearch(){searchValue=encodeURIComponent(searchField.val()).replace(/%20/g,"+"),fetchProductsPage(category,sort,searchValue,tag)}searchField.on("input",debounce(handleSearch,300)),$(window).on("beforeunload",function(){localStorage.setItem("scrollPosition",$(window).scrollTop())})});
//# sourceMappingURL=/cdn/shop/t/11/assets/new-sort.js.map?v=74047914308991940681724042226
